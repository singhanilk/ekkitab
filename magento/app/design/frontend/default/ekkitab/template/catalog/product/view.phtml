<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Ekkitab_Catalog_Block_Product_View
 */
?>
<?php
    $_helper = $this->helper('catalog/output');
    $_product = $this->getProduct();
	if(!is_null($_product)){
		
		$isbn = $_product->getIsbn();
		$sourcedFrom =  $_product->getSourcedFrom();
		if($sourcedFrom && strlen(trim($sourcedFrom)) > 0 && strtolower($sourcedFrom)=='us'){
			$isbn.= " <em>[ International Edition ]</em>";
		}

		$authors = $_product->getAuthor();
		$productUrl = $_product->getProductUrl();
		$inStock = $_product->getInStock();
		$publishers=$_product->getPublisher();
		$publishDate=$_product->getPublishingDate();
		
		$author = $authors['a'];
		$editors=$authors['e']	;
		$translators=$authors['t'];
		$illustrators=$authors['i'];
		$photographers=$authors['p'];
		$others=$authors['o'];

		$parsedAuthor = "";
		$parsedAuthor.= strlen($author) > 0 ? "by ".$author." (Author)" : "";
		$parsedAuthor.= strlen($editors) > 0 ?(strlen($parsedAuthor) > 0 ? "; ":"").$editors." (Editor)" : "";
		$parsedAuthor.= strlen($translators) > 0 ? (strlen($parsedAuthor) > 0 ? "; ":"").$translators."(Translators)" : "";
		$parsedAuthor.= strlen($illustrators) > 0 ? (strlen($parsedAuthor) > 0 ? "; ":"").$illustrators." (Illustrators)" : "";
		$parsedAuthor.= strlen($photographers) > 0 ? (strlen($parsedAuthor) > 0 ? "; ":"").$photographers."(Photographers) " : "";

		$listPrice = $_product->getListPrice() ;
		$discPrice = $_product->getDiscountPrice();
		$savings= $listPrice - $discPrice;
		$savingsPerct= round(($listPrice >0 )? (($listPrice - $discPrice)/ $listPrice ) * 100 : 0);
		$shippingTimeMin = (int)$_product->getDeliveryPeriod();
		$shippingTimeMax = round($shippingTimeMin + (.5 * $shippingTimeMin) );
		$shippingTime = ( $shippingTimeMin > 0 && $shippingTimeMax > 0 ) ? "Ships in ".$shippingTimeMin." - ".$shippingTimeMax." days":"";
		$publishers=strlen($publishers)>0 ? ucwords($publishers):"NA";
		$image = $_product->getImage();
?>
<div class="searchArea">
	<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
		<div class="bigImage">
           <img src="<?php echo $this->helper('ekkitab_catalog')->resize($image,'image',false,null, 200); ?>">
        </div>
		<div class="midArea">
			<div class="finDetBkTitle"><?php echo $this->htmlEscape($_product->getTitle()) ?> <?php echo (strlen($author) > 0 )? "<br/><span class=\"lineHeight14em\"> by ".$author ."</span>" :""?></div><!-- authorEtc -->
			<div class="lineHeight14em"><span class="boldFont">ISBN:  <?php echo $isbn ?></span></div>
			<div class="lineHeight14em"><span class="boldFont">Binding: <?php echo ucwords($_product->getBinding()) ?></span></div>
			<div class="lineHeight14em"><span class="boldFont">Publisher:  <?php echo $publishers ?></span></div>
			<div class="lineHeight14em"><span class="boldFont">Publishing Date:  <?php echo $publishDate ?></span></div>
			<div class="lineHeight14em"><span class="boldFont">Language : <?php echo ucwords($_product->getLanguage()) ?></span></div>
			<?php if($editors && trim($editors)!=''):?>
			  <div class="lineHeight14em"><span class="boldFont">Editors : <?php echo ucwords($editors) ?></span></div>
			<?php endif;?>
			
			<?php if($illustrators && trim($illustrators)!=''):?>
			  <div class="lineHeight14em"><span class="boldFont">Illustrators : <?php echo ucwords($illustrators) ?></span></div>
			<?php endif;?>
			
			<?php if($translators && trim($translators)!=''):?>
			  <div class="lineHeight14em"><span class="boldFont">Translators : <?php echo ucwords($translators) ?></span></div>
			<?php endif;?>
			
			<?php if($photographers && trim($photographers)!=''):?>
			  <div class="lineHeight14em"><span class="boldFont">Photographers : <?php echo ucwords($photographers) ?></span></div>
			<?php endif;?>
			
			
			<?php if($others && trim($others)!=''):?>
			  <div class="lineHeight14em"><span class="boldFont">Other Contributors : <?php echo ucwords($others) ?></span></div>
			<?php endif;?>
			
			<?php if(!$inStock || $_product->getListPrice() <= 0):?>
			  <div class="marginTop5px"><img src="<?php echo $this->getSkinUrl('images/out_of_stock_image.png')?>" align="absmiddle"> &nbsp; <a href="<?php echo $this->helper('ekkitab_catalog')->getWishListAddUrl($_product->getId()) ?>">Add to Wishlist</a> </div>

			<?php endif;?>
			<div class="finDetSynop">
				<?php echo $_product->getDescription() ?>
			</div><!-- finDetSynop -->
			
			 <?php echo $this->getChildHtml('review_list')?>
			<br class="clear"/>
		</div><!-- midArea -->
		
		
	<div class="buyArea">
		<div class="youSave">Our Price: <?php echo Mage::helper('core')->currency($_product->getFinalPrice(),true,false) ?></div>
		<?php if($_product->getListPrice() > 0):?><div class="authorEtc">MRP : <?php echo Mage::helper('core')->currency($_product->getListPrice(),true,false) ?></div><?php endif; ?>
		<div class="youSave"><?php if($savings > 0):?>Save <?php echo Mage::helper('core')->currency($savings,true,false) ?><?php endif; ?>
		<?php if($savingsPerct > 0):?>(<?php echo $savingsPerct?>%)<?php endif; ?></div>
		<div class="authorEtc"><?php echo $shippingTime ?></div>
		<?php if($inStock && $_product->getListPrice() > 0):?>
			<form action="<?php echo $this->helper('ekkitab_catalog')->getCartUrl($_product->getId(),$this->helper('core/url')->getCurrentUrl()) ?>" method="post" id="product_addtocart_form">

			<?php echo $this->getChildHtml('addtocart') ?>
			<fieldset class="no-display">
			  <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
			  <input type="hidden" name="related_product" id="related-products-field" value="" />
			</fieldset>
			</form>
		<?php endif;?>
		<div class="dottedLineBig"></div>
		<!-- otherBut -->
			<?php echo $this->getChildHtml('donate_book_blurb') ?>
			</div>
		<div class="clear"></div>
		<!-- buyArea -->
		</div><!-- searchArea -->
<script type="text/javascript">
//<![CDATA[
    var productAddToCartForm = new VarienForm('product_addtocart_form');
    productAddToCartForm.submit = function() {
        if(this.validator.validate()) {
            this.form.submit();
        }
    }.bind(productAddToCartForm);
//]]>
</script>
</div>
<br /><br />
<?php echo $this->getChildHtml('info_tabs') ?>
<?php } else { ?>
	<div class="notFoundArea">
		<div class="pageHeader">Our Apologies...</div>
		<p> <div class="boldFont"> The content you have requested for is not available.</div>
		<ul>

		<li>If you typed the URL directly, please make sure that the spelling is correct.</li>
		<li>If you clicked on a link to get here, the link might be outdated</li></ul>
		</p>
		<p><div class="boldFont">What can you do?</div>
		Please contact Customer Care at  <a href="mailto:support@ekkitab.com">support@ekkitab.com</a> and let us know of this problem. We appreciate your help in ensuring that the service is available and runs error free.
		<ul>
		<li>Go <a href="javascript:history.back();">back to the previous page</a></li>
		<li>Use the Search Facility at the top of the page to search the ekkitab web site</li>
		<li>Click on any of the links below to get you back on track
		<ul><li><a href="<?php echo $this->getUrl('home')?>">ekkitab Home Page</a></li>
		<li><a href="<?php echo $this->getUrl('customer/account')?>">My Account</a> (You will have to Sign in or Register, if it's your first time)</li>
		</ul>
		</li></ul>
		</p>
	</div><!-- notFoundArea -->
<?php }?>