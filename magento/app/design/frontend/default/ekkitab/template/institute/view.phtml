<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Ekkitab_Catalog_Block_Product_View
 */
?>
<?php
	$_institute = $this->getInstitute();
	if(!is_null($_institute)){
		$image = $_institute->getImage();
?>
<div class="instituteArea">
	<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
	
	<div class="midArea">
		<div class="finDetBkTitle"><?php echo $_institute->getName() ?> </div><!-- authorEtc -->
		<div class="finDetSynop">
			<div class="bigImage">
			   <img src="<?php echo $this->helper('ekkitab_institute')->resize($image,'image',false,220, null); ?>"><br/>
			</div>
			<?php $desc = $_institute->getAboutus();
				  echo $desc; ?>
			<div class="clear"></div>
		</div><!-- finDetSynop -->
<?php	$orgWishlist = 	$this->getOrganizationWishlist();
		if($orgWishlist->getSize()): 
		  $_count=$orgWishlist->getSize();
		  $_columnSize=3;
		  $counter=0;
	      $firstTime=0;
		  if($_count > 0){
			$_totalRows= intval($_count/ $_columnSize) ;
			$_totalRows= ($_count % $_columnSize) > 0 ? $_totalRows +1 : $_totalRows  ;
		  }else{
			$_totalRows= 0;
		  }
		  $_totalRows= 1;

		?>
		<p><div class="wishlistHdr"><?php echo $this->__("We would be glad to have these Books in our Library") ?></div></p>
		<form action="<?php echo $this->getMoveSelectedCartUrl()?>" method="post">
			<?php echo $this->getBlockHtml('formkey')?>
			<table cellspacing="0" width="100%" class="custom-data-table box-table wishlist" id="wishlist-table">
			<col width="25"/>
			<col width="70"/>
			<col width="215"/>
			<col width="25"/>
			<col width="70"/>
			<col width="215"/>
			<col width="25"/>
			<col width="70"/>
			<col width="215"/>
			<tbody>
			<?php foreach($orgWishlist as $item): 
					$listPrice = (!is_null($item->getListPrice()))? $item->getListPrice() : 0;
					$discPrice = $item->getDiscountPrice();
					$savings= $listPrice - $discPrice;
					$savingsPerct= round(($listPrice >0 )? (($listPrice - $discPrice)/ $listPrice ) * 100 : 0);
					$stock=$item->getInStock();
				    if($counter%$_columnSize==0){  
						if($firstTime!=0){  
?>							</tr>
<?php					}					?>
					<tr>
<?php				}
					$counter+=1;
?>
					<td>
						<input type="checkbox" value="1" name="cart[<?php echo $item->getWishlistItemId() ?>][wishlist]" <?php if($stock==0 || $listPrice <= 0) : ?> disabled<?php endif;?>/> 
					</td>
					<td>
						<div class="thumbnail"><a href="<?php echo $this->getUrl($item->getProductUrl()) ?>"><img src="<?php echo $this->helper('ekkitab_catalog')->resize($item->getImage(), 'thumbnail',false,null,74); ?>" class="img-border" alt="<?php echo $this->htmlEscape($item->getName()) ?>" /></a></div>
					</td>
					<td align="left">
						<div><a href="<?php echo $this->getUrl($item->getProductUrl()) ?>" title="<?php echo $this->htmlEscape($item->getName()) ?>"><?php echo $this->htmlEscape($item->getName()) ?></a></div>
						<?php if($discPrice > 0 && $stock!=0 && $listPrice > 0 ):?>
							<div class="youSave">Our Price: <?php echo Mage::helper('core')->currency($discPrice,true,false) ?> <!--<?php if($savingsPerct > 0):?><br/>Save: <?php echo $savingsPerct ?>%<?php endif; ?>--></div>
						<?php endif; ?>
						<?php if($listPrice > 0):?>
							<!--div class="lineHeight14em">MRP Price : <?php echo Mage::helper('core')->currency($listPrice,true,false) ?></div-->
						<?php endif; ?>
						<?php if($item->isSaleable()): ?>
							<!--a href="<?php echo $this->getItemAddToCartUrl($item,$_institute->getId()) ?>"><img src="<?php echo $this->getSkinUrl('images/move_cart_button_grey.png') ?>" alt="<?php echo $this->__('Add to Cart') ?>" class="v-middle"/></a><br/-->
						<?php endif; ?>
						<div class="youSave"><?php if($stock==0 || $listPrice <=0) : ?>Out of Stock<?php endif;?> </div><br/>
					</td>
<?php			$firstTime =1;
			endforeach;
			if($counter%$_columnSize==1){ ?>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
<?php		}
			if($counter%$_columnSize==2){ ?>
				<td></td>
				<td></td>
				<td></td>
<?php		}				?>

			</tr>
		</tbody>
		<input type="hidden" value="<?php echo $_institute->getId()?>" name="org"/> 
	</table>
		<script type="text/javascript">decorateTable('wishlist-table')</script>
		<div class="content" style="text-align:center">
				<?php if($this->isSaleable()):?>
					&nbsp;<input type="image" src="<?php echo $this->getSkinUrl('images/donate_bks_selected.jpg');?>" alt="<?php echo $this->__('Donate Selected to Cart') ?>" />&nbsp;
				<?php endif;?><br/></li>
				<br/><a href="<?php echo $this->getBackUrl() ?>" class="f-left">&laquo; <?php echo $this->__('Back') ?></a></li>
		</div>
	</form>
<?php else: ?>
    <p><?php echo $this->__("There is no wishlist added to %s's wishlist",$_institute->getName()) ?></p>
    <div class="button-set">
        <a href="<?php echo $this->getBackUrl() ?>" class="f-left">&laquo; <?php echo $this->__('Back') ?></a>
    </div>
<?php endif ?>

	</div><!-- midArea -->
	
	<!--div class="buyArea">
		<?php echo $this->getChildHtml('donate_book_blurb') ?>
	</div-->

	<!-- buyArea -->

	<div class="clear"></div>
</div><!-- searchArea -->
	<script type="text/javascript">
	//<![CDATA[
		var productAddToCartForm = new VarienForm('product_addtocart_form');
		productAddToCartForm.submit = function() {
			if(this.validator.validate()) {
				this.form.submit();
			}
		}.bind(productAddToCartForm);
	//]]>
	</script>
<br /><br />
<?php } else { ?>
	<div class="notFoundArea">
		<div class="pageHeader">Our Apologies...</div>
		<p> <div class="boldFont"> The content you have requested for is not available.</div>
		<ul>

		<li>If you typed the URL directly, please make sure that the spelling is correct.</li>
		<li>If you clicked on a link to get here, the link might be outdated</li></ul>
		</p>
		<p><div class="boldFont">What can you do?</div>
		Please contact Customer Care at  <a href="mailto:support@ekkitab.com">support@ekkitab.com</a> and let us know of this problem. We appreciate your help in ensuring that the service is available and runs error free.
		<ul>
		<li>Go <a href="javascript:history.back();">back to the previous page</a></li>
		<li>Use the Search Facility at the top of the page to search the ekkitab web site</li>
		<li>Click on any of the links below to get you back on track
		<ul><li><a href="<?php echo $this->getUrl('home')?>">ekkitab Home Page</a></li>
		<li><a href="<?php echo $this->getUrl('customer/account')?>">My Account</a> (You will have to Sign in or Register, if it's your first time)</li>
		</ul>
		</li></ul>
		</p>
	</div><!-- notFoundArea -->
<?php }?>
